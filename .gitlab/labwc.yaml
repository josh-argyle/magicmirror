build_labwc:
  stage: build
  variables:
    CNTNR_CONTEXT: "./build/labwc"
    CNTNR_FILE_DIR: "./build/labwc"
    GIT_DEPTH: 1
    TARGETPLATFORM: "linux/amd64,linux/arm64,linux/arm/v7"
  script:
    - !reference [.init, script]
    - |
      # todo: remove following line after DEBIAN_VERSION_MASTER is switched to trixie:
      [[ "$DEBIAN_VERSION" == "bookworm" ]] && DEBIAN_VERSION="trixie"
      export BUILDKIT_VARS="DEBIAN_VERSION"
      if [[ "${CI_COMMIT_BRANCH}" == "master" ]]; then
        export PUSH_IMAGES="karsten13/labwc:latest,karsten13/labwc:$(date '+%F')"
      else
        export PUSH_IMAGES="karsten13/labwc:${CI_COMMIT_BRANCH}"
      fi
      build
  rules:
    - if: $TASK == "build_labwc"
